<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1" />
<title>Box Backup verify and restore files</title>
<link rel="stylesheet" href="bbstyles.css" type="text/css" />
</head>
<body>
<div align="center">
<div id="header">
<div id="logo">
<img src="images/bblogo.png" alt="logo" height="65" width="331" border="0" vspace="5" align="middle" /> <img src="images/stepahead.png" alt="a step ahead in data security" width="182" height="11" hspace="10" vspace="20" border="0" align="middle" /></div>
</div>
<div id="page">

<h1>Box Backup verify and restore files</h1>

<p>Backups are no use unless you can restore them. The <tt>bbackupquery</tt> utility does
this and more.</p>

<p>You don't provide any login information to it, as it just picks up the data it needs
from <tt>/etc/box/bbackupd.conf</tt>. You should run it as root so it can find everything
it needs.</p>

<p>Full documentation can be found in <tt>bin/bbackupquery/documentation.txt</tt> in the distribution
archive. It follows the model of a command line sftp client quite closely.</p>

<p>On systems where GNU readline is available (by default) it uses that for command line history and
editing. Otherwise it falls back to very basic UNIX text entry.</p>


<h2>Verify backups</h2>

<p>Since this is a development system, you'll be keen to verify that your backups are 
correct. This is easy.</p>

<pre>
/usr/local/bin/bbackupquery "compare -a" quit
</pre>

<p>It will report all the differences between the store and the files on disc. It will download
everything, so may take a while. You should expect to see some differences on a typical compare,
because files which have recently changed are unlikely to have been uploaded yet. Consider checking the
timestamps on the files, or keeping a record of these messages and comparing them with a future verification.</p>

<p>If you would like to do a "quick" check which just downloads file
checksums and compares against that, then do</p>

<pre>
/usr/local/bin/bbackupquery "compare -aq" quit
</pre>

<p>However, this does not check that the file attributes are correct, and since the checksums are generated
on the client they may not reflect the data on the server if there is a problem -- the server cannot check
the encrypted contents. View this as a good indication, rather than a definite check that your backup
verifies correctly.</p>

<p>You may wish to run either one as a cron job while testing this system.</p>


<h2>Restore backups</h2>

<p>You will need the keys file created when you configured the server. Without it, <b>you cannot
restore the files</b>; this is the downside of encrypted backups. However, by keeping the small
keys file safe, you indirectly keep your entire backup safe.</p>

<p>The first step is to recreate the configuration of the backup client. It's probably best
to have stored the /etc/box directory with your keys. But if you're recreating it, all you really
need is to have got the login infomation correct (ie the certs and keys).</p>

<p><b>Don't run bbackupd yet!</b> It will mark all your files as deleted if you do, which is not
hugely bad in terms of losing data, just a major inconvenience. (This assumes that 
you are working from a blank slate. If you want to restore some files to a different location,
it's fine to restore while bbackupd is running, just do it outside a backed up directory to make
sure it doesn't start uploading the restored files.)</p>

<p>Type <tt>/usr/local/bin/bbackupquery</tt> to run it in interactive mode.</p>

<p>Type <tt>list</tt> to see a list of the locations stored on the server.</p>

<p>For each location you want to restore, type <tt>restore name-on-server local-dir-name</tt>. The 
directory specified by local-dir-name must not exist yet.</p>

<p>If the restore is interrupted for any reason, repeat the above steps, but add the <tt>-r</tt>
flag to the restore command to tell it to resume.</p>


<h2>Other tricks</h2>

<p>bbackupquery can also...
<ul>
<li>List files on the server
<li>Restore arbitary parts of the file system
<li><a href="retrieve.html">Recover deleted files</a> (either if the backup daemon hasn't deleted them from the store,
or if they are marked on the store as deleted but not actually gone yet.)
<li><a href="retrieve.html">Recover old versions</a> of files which are still on the server.
</ul>
</p>

<p>Read <tt>bin/bbackupquery/documentation.txt</tt> for more details.</p>

<p>&nbsp;</p>
<p>&copy; Ben Summers, 2003, 2004</p>
<p>&nbsp;</p>
</div>
</div>
</body>
</html>